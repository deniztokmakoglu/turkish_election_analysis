---
title: "preliminary_regression"
author: "Deniz Tokmakoglu"
date: "12/7/2021"
output: html_document
---

```{r setup, include=FALSE}
library("tidyverse")
library("knitr")
library("stargazer")
library(readstata13)

library("tidyverse")
library("knitr")
library("stargazer")
library(readstata13)
library(ggplot2)
library("stringr")
library(data.table)
library("reticulate")
library(fixest)
library(sandwich)
library(lmtest)
library(ggplot2)
library("stringr")
library(data.table)
library("reticulate")
library(fixest)
library(sandwich)
library(tidyverse)
library(lubridate)
library(jtools)
library(rdd)
library(ggplot2)
library(WeightIt)
library(DescTools)
library(knitr)
library(extrafont)
library(splines)
library(lubridate)
library(stargazer)
library(dplyr)
library(data.table)
library(janitor)
library(gcookbook)
library(plm)
library(lfe)
library(modelsummary)
library(formattable)
library(lmtest)
```

```{r}
election_all <- read_csv("clean_data/all_data_v_event2.csv")
```



# Initial Regression
```{r}

election_all <- election_all %>% mutate(event_right_after = ifelse(year_int - event_year <= 4, 1, 0))

election_all <- election_all %>% 
  mutate(percent_turnout = ifelse(percent_turnout < 1, 100 * percent_turnout, percent_turnout))

reg1 <- felm(percent_turnout ~ event_right_after, data = election_all)

reg2 <- felm(percent_turnout ~ event_right_after + kurdish + refugee | city + year , data = election_all)

stargazer(reg1, reg2, type = "text")
```

# Diff and Diff

```{r}
election_all2 <- election_all %>% select(city, year_int, election_type,
                                      percent_turnout, event_year, event)

election_all2 <- election_all2 %>% 
  mutate(time_to_treat = ifelse(event_year == 0, 0, round((year_int - event_year) / 4)),
         treat = ifelse(event_year == 0, 0, 1))

election_all2 <- election_all2 %>% filter(time_to_treat <= 10)

mod_twfe = feols(percent_turnout ~ i(time_to_treat, treat, ref = -1) ## Our key interaction: time Ã— treatment status
		 |city + year_int,                             ## FEs
		 cluster = ~city ,                          ## Clustered SEs
		 data = election_all2)



summary(mod_twfe)

iplot(mod_twfe, 
      xlab = 'Time to treatment',
      main = 'Event study: Staggered treatment (TWFE)')
```

